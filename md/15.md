15         Manejo de ficheros
=============================

![](e20514ca-a096-442d-8ee5-3f2997bc2ec72106301532469382130.021.jpeg)

Hasta ahora hemos manejado pocos datos, lo que el usuario escribe por pantalla o lo que tenemos en variables. Pero si queremos utilizar cantidades más grandes de datos, podemos leer y escribir en ficheros. Existen toda clase de ficheros, desde texto, multimedia (música, vídeo) hasta binarios. Todos ellos se pueden manejar desde un programa. Como una introducción, vamos a ver cómo podemos manejar ficheros de texto.

15.1 Lectura de ficheros
------------------------

Para poder leer un fichero, necesitamos por un lado que exista ese fichero, luego ya lo podemos abrir y leer. En el siguiente código, se lee un fichero que está en el mismo sitio que el propio programa:

```Python
fichero = open("texto.txt", "r")
contenido = fichero.read()
print(contenido)
fichero.close()
```

A tener en cuenta:

 - Para leer el fichero, primero hay que abrirlo con open

 - Al abrir el fichero hay que indicar su nombre y si está en otro directorio, la ruta hacia el mismo. Si estuviera dentro de carpeta fichero, la ruta sería fichero/texto.txt.

 - El parámetro "r" indica que el fichero lo leemos solo en modo lectura o read. El fichero de texto podría ser algo así, y el programa mostraría eso mismo por pantalla.

```console
Este es un texto
de varias líneas
Y se puede leer
muy fácilmente
```

### 15.1.1 ¿Leyendo línea a línea?

En el ejemplo anterior, hemos leído todo el contenido del fichero de golpe, guardándolo en una variable de texto. Pero a veces, puede que nos interese leer el fichero línea a línea. Para ello debemos utilizar la función readline como se ve a continuación:

```Python
fichero = open("texto.txt", "r")
lineas = fichero.readline()
for linea in lineas:
    print(linea)

fichero.close()
```

15.2 Ficheros JSON
------------------

Los ficheros de texto simples como el anterior pueden contener información, pero no son datos muy manejables para un programa. Si queremos leer o guardar datos que un programa pueda manipular fácilmente, conviene usar algún formato concreto. Uno de los formatos más populares en programación es el formato JSON. Es un formato que se parece a las estructuras de diccionario en Python. Incluso también tiene la opción de representar listas como las del lenguaje. El siguiente contenido está en formato JSON. Se trata de una lista que contiene varios objetos. Si te fijas, los objetos en JSON ¡son iguales a los diccionarios en Python!

```Python
 [
    {"id": 66, "nombre": "Ada"},
    {"id": 2, "nombre": "Neko"},
    {"id": 4, "nombre" : "Bug"}
 ]
```

Lo bueno de ese formato es que se puede importar a nuestro programa Python fácilmente, siempre que sea correcto, claro.

Para poder leer ese contenido y convertir esos datos en una lista de diccionarios, utilizaremos la librería json. Mediante la función json.load podremos cargar de forma automática el contenido de ese fichero en una variable. A partir de ahí podremos manejar todo ese contenido como una lista, ¡donde cada elemento es un diccionario!:

```Python
import json

fichero = open("texto.json", "r")
contenido = json.load(fichero)

for personaje in contenido:
    print(personaje ["nombre" ])

fichero.close()
```

Por pantalla veríamos:

```console
Ada
Neko
Bug
```

15.3 Escritura de ficheros
--------------------------

Para escribir ficheros, el proceso es similar pero debemos hacer dos cosas:

 - Abrir el fichero en modo escritura.

 - Utilizar la función write para escribir contenido.

Con el siguiente código, escribiremos un par de líneas de texto en el fichero:

```Python
fichero = open("texto.txt", "w")
fichero.write("Escribo una línea  n")
fichero.write("Escribo otra línea  n")
fichero.close()
```


¡OJO!

Si escribimos de esa manera, estaremos machacando el contenido del fichero. Contenido del fichero:

```console
Escribo una línea
Escribo otra línea
```


Si queremos escribir añadiendo contenido, debemos abrir el fichero en modo "a":

```Python
fichero = open("texto.txt", "a")
fichero.write("Añado una línean")
fichero.write("Añado otra línean")
fichero.close()
```

Ahora el contenido del fichero sería:

```console
Escribo una línea
Escribo otra línea
Añado una línea
Añado otra línea
```

15.4 Escribir en un fichero json
--------------------------------

En el caso de un fichero en formato JSON, lo que nos tiene que preocupar es que al momento de escribir, convirtamos nuestros datos a texto. Por suerte para eso hay una función que lo hace de forma automática: json.dumps()

En el siguiente ejemplo, se carga el contenido de un fichero json dentro de una variable. Luego añadimos un elemento a esa lista. Abrimos el fichero otra vez, en modo escritura, y hacemos un write utilizando json.dumps para convertir el contenido en texto:

```Python
import json

fichero = open("texto.json", "r")
contenido = json.load(fichero)
fichero.close()

personaje = { "id": 666, "nombre": "Gumball" }
contenido.append(personaje)

fichero = open("texto.json", "w")
fichero.write(json.dumps(contenido))
fichero.close()
```
